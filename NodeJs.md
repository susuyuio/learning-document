# 深入浅出Node.js

_`高并发、高性能`_

[[CNode开源技术社区]](https://cnodejs.org/)
[[Node官网]](https://nodejs.org/en/)

---

## 简介

- Web服务器的几个要点：**事件驱动**、**非阻塞I/O**
- Node的结构与Chrome十分相似：给予事件驱动的 `异步` 架构（服务界面上的交互/服务I/Os）
- Node 特点：
    1. 异步I/O
    2. 事件与回调函数
    3. 单线程
        - 优势
            - 不用处处在一状态的同步问题
            - 没有死锁的存在
            - 没有线程上下文交换所带来的性能开销
        - 弱点
            - 无法利用多核CPU
            - 错误会引起整个应用退出，应用的健壮性值得考验
            - 大量计算占用CPU导致无法继续调用异步I/O
        - Node采用与Web Workers相同的思路来解决单线程中大计算量的问题：`child_process`
            - 通过将计算分发到各个子进程中，分解大量计算，再通过进程之间的事件消息来传递结果，很好地保持应用模型的简单和低依赖
            - 通过Master-Worker的管理方式，也可以很好地管理各个工作进程，以达到更高的健壮性
    4. 跨平台
        - 主要得益于Node再架构层面的改动，它再操作系统与Node上层模块系统之间构建了一层平台层架构，`libuv`。目前libuv已经成为许多系统实现跨平台的基础组件
- 应用场景
    1. I/O密集型
        - Node面向网络且擅长并行I/O，能够有效地组织起更多的硬件资源，从而提供更好的服务
        - I/O密集的优势主要在于Node利用事件循环的处理能力，而不是启动每一个线程为每一个请求服务，资源占用极少

## 模块机制

#### `CommonJS`模块规范

- CommonJS对模块的定义主要分为：模块引用、模块定义、模块标识
    1. 模块引用

        ``` js
        var math = require('math');
        ```

    2. 模块定义
        - 在Node中，一个文件就是一个模块，将方法挂载在exports对象上作为属性即可定义导出的方式

        ``` js
        // math.js
        exports.add = function() {...};

        // program.js
        var math = require('math');
        exports.increament = function(val) {
            return math.add(val, 1);
        };
        ```

    3. 模块标识
        - require()参数必须是符合小驼峰命名字符串，或者绝对路径、相对路径

### `keyword`

- web服务器
- 浏览器中除了 **V8** 作为JS引擎外，还有 **Webkit布局引擎**
- **Web Workers** 创建工作线程来进行计算，以解决JS大量计算阻塞UI渲染的问题。工作线程为了不阻塞主线程，通过消息传递的方式来传递运行结果，使得工作线程不能访问到主线程中的UI